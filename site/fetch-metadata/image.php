<?php
declare(strict_types = 1);

namespace FetchMetadata;

use GdImage;
use stdClass;

readonly class Headers
{

    public GdImage $image;
    private int $bg;
    public int $color;
    public int $darkerColor;

    public function __construct()
    {
        $this->image = imagecreate(300, 105);
        $this->bg = imagecolorallocate($this->image, 51, 51, 68);
        $this->color = imagecolorallocate($this->image, 255, 255, 255);
        $this->darkerColor = imagecolorallocate($this->image, 160, 160, 160);
    }

    public function createHeader(string $header): stdClass
    {
        if (isset($_SERVER[$header])) {
            if ($_SERVER[$header] !== '') {
                $value = $_SERVER[$header];
                $color = imagecolorallocate($this->image, 255, 255, 255);
            } else {
                $value = 'empty string';
                $color = $this->darkerColor;
            }
        } else {
            $value = 'not present';
            $color = $this->darkerColor;
        }
        return (object)['value' => $value, 'color' => $color];
    }

}

$headers = new Headers();

$header = $headers->createHeader('HTTP_SEC_FETCH_DEST');
imagestring($headers->image, 4, 15, 5, 'Sec-Fetch-Dest: ', $headers->color);
imagestring($headers->image, 4, 143, 5, $header->value, $header->color);
$header = $headers->createHeader('HTTP_SEC_FETCH_MODE');
imagestring($headers->image, 4, 15, 25, 'Sec-Fetch-Mode: ', $headers->color);
imagestring($headers->image, 4, 143, 25, $header->value, $header->color);
$header = $headers->createHeader('HTTP_SEC_FETCH_SITE');
imagestring($headers->image, 4, 15, 45, 'Sec-Fetch-Site: ', $headers->color);
imagestring($headers->image, 4, 143, 45, $header->value, $header->color);
$header = $headers->createHeader('HTTP_SEC_FETCH_USER');
imagestring($headers->image, 4, 15, 65, 'Sec-Fetch-User: ', $headers->color);
imagestring($headers->image, 4, 143, 65, $header->value, $header->color);

imagestring($headers->image, 2, 15, 85, '(This is an image, generated at ' . date('H:i:s') . ')', $headers->darkerColor);

header('Content-type: image/png');
imagepng($headers->image);
imagedestroy($headers->image);
